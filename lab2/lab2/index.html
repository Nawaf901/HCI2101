colorBox.style.backgroundColor = color;
                colorBox.onclick = () => selectColor(colorBox, color);
                colorOptionsDiv.appendChild(colorBox);
            });

            // إعادة تعيين المتغيرات وعرضها
            selectedColor = null;
            resultDiv.innerHTML = '';
            attempts = 3;
            attemptsDiv.textContent = المحاولات المتبقية: ${attempts};
            scoreDiv.textContent = النقاط: ${score};
            
            // إزالة أي تحديد سابق
            document.querySelectorAll('.color-box').forEach(box => box.classList.remove('selected'));
        }

        function selectColor(element, color) {
            // إزالة التحديد من جميع المربعات
            document.querySelectorAll('.color-box').forEach(box => box.classList.remove('selected'));
            // إضافة التحديد للمربع المختار
            element.classList.add('selected');
            selectedColor = color;
        }

        function checkGuess() {
            if (!selectedColor) {
                resultDiv.innerHTML = '<span class="wrong">الرجاء اختيار لون أولاً!</span>';
                return;
            }

            if (attempts <= 0) {
                resultDiv.innerHTML = '<span class="wrong">انتهت محاولاتك! أعد اللعب.</span>';
                return;
            }

            if (selectedColor === secretColor) {
                resultDiv.innerHTML = '<span class="correct">أحسنت! لقد خمنت اللون الصحيح!</span>';
                score++;
                scoreDiv.textContent = النقاط: ${score};
                // بدء جولة جديدة بعد التخمين الصحيح
                setTimeout(initializeGame, 1500); // إعادة تعيين اللعبة بعد 1.5 ثانية
            } else {
                resultDiv.innerHTML = '<span class="wrong">خطأ! حاول مرة أخرى.</span>';
                attempts--;
                attemptsDiv.textContent = المحاولات المتبقية: ${attempts};
                if (attempts === 0) {
                    resultDiv.innerHTML += '<br><span class="wrong">انتهت محاولاتك! اللون السري كان: ' + secretColor + '</span>';
                    // يمكنك تعطيل زر التأكيد هنا إذا أردت
                }
            }
            selectedColor = null; // مسح الاختيار بعد التحقق
            document.querySelectorAll('.color-box').forEach(box => box.classList.remove('selected')); // إزالة التحديد المرئي
        }

        function resetGame() {
            score = 0; // إعادة تعيين النقاط عند إعادة اللعب الكلي
            initializeGame();
        }

        // بدء اللعبة عند تحميل الصفحة
        initializeGame();
    </script>

</body>
</html>